# Data Visualization: What The Tables Look Like

## 1. Raw Fills (Source Data from S3)

This is what we ingest from `node_fills_by_block`. Each row is one fill.

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                           fills                                                                          │
├──────────────────────────┬───────┬───────────┬──────────┬──────┬─────────────┬────────────────┬────────────┬─────────┬─────────┬────────┤
│ user_address             │ coin  │ price     │ size     │ side │ direction   │ start_position │ closed_pnl │ fee     │ crossed │ time   │
├──────────────────────────┼───────┼───────────┼──────────┼──────┼─────────────┼────────────────┼────────────┼─────────┼─────────┼────────┤
│ 0xabc123...def           │ BTC   │ 95,420.50 │ 0.5      │ B    │ Open Long   │ 0.0            │ 0.00       │ -47.71  │ true    │ 09:15  │
│ 0xabc123...def           │ BTC   │ 96,100.00 │ 0.5      │ S    │ Close Long  │ 0.5            │ 339.75     │ -48.05  │ true    │ 14:32  │
│ 0xabc123...def           │ ETH   │ 3,450.25  │ 10.0     │ B    │ Open Long   │ 0.0            │ 0.00       │ -34.50  │ false   │ 14:45  │
│ 0xabc123...def           │ ETH   │ 3,480.00  │ 5.0      │ S    │ Close Long  │ 10.0           │ 148.75     │ -17.40  │ true    │ 16:20  │
│ 0xabc123...def           │ ETH   │ 3,420.00  │ 5.0      │ S    │ Close Long  │ 5.0            │ -151.25    │ -17.10  │ true    │ 18:05  │
│ 0x789xyz...456           │ SOL   │ 185.50    │ 100.0    │ S    │ Open Short  │ 0.0            │ 0.00       │ -9.28   │ false   │ 10:00  │
│ 0x789xyz...456           │ SOL   │ 182.25    │ 100.0    │ B    │ Close Short │ -100.0         │ 325.00     │ -9.11   │ false   │ 10:02  │
│ 0x789xyz...456           │ SOL   │ 182.30    │ 200.0    │ S    │ Open Short  │ 0.0            │ 0.00       │ -18.23  │ false   │ 10:02  │
│ 0x789xyz...456           │ SOL   │ 181.90    │ 200.0    │ B    │ Close Short │ -200.0         │ 80.00      │ -18.19  │ false   │ 10:05  │
│ ...                      │ ...   │ ...       │ ...      │ ...  │ ...         │ ...            │ ...        │ ...     │ ...     │ ...    │
└──────────────────────────┴───────┴───────────┴──────────┴──────┴─────────────┴────────────────┴────────────┴─────────┴─────────┴────────┘

Key observations:
- 0xabc123: Made 3 closing trades, 2 winners (+339.75, +148.75), 1 loser (-151.25)
- 0x789xyz: HFT pattern - 2 minute holding periods, all maker (crossed=false), small profits
```

---

## 2. Computed: Position Reconstruction

From fills, we reconstruct position lifecycle to get holding periods:

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                  position_history                                                       │
├──────────────────────────┬───────┬───────────┬────────────┬─────────────────┬─────────────────┬─────────────┬──────────┤
│ user_address             │ coin  │ direction │ entry_price│ entry_time      │ exit_time       │ holding_hrs │ pnl      │
├──────────────────────────┼───────┼───────────┼────────────┼─────────────────┼─────────────────┼─────────────┼──────────┤
│ 0xabc123...def           │ BTC   │ LONG      │ 95,420.50  │ 2025-07-28 09:15│ 2025-07-28 14:32│ 5.28        │ +339.75  │
│ 0xabc123...def           │ ETH   │ LONG      │ 3,450.25   │ 2025-07-28 14:45│ 2025-07-28 18:05│ 3.33        │ -2.50    │
│ 0x789xyz...456           │ SOL   │ SHORT     │ 185.50     │ 2025-07-28 10:00│ 2025-07-28 10:02│ 0.03        │ +325.00  │
│ 0x789xyz...456           │ SOL   │ SHORT     │ 182.30     │ 2025-07-28 10:02│ 2025-07-28 10:05│ 0.05        │ +80.00   │
└──────────────────────────┴───────┴───────────┴────────────┴─────────────────┴─────────────────┴─────────────┴──────────┘

Note: 0xabc123's ETH position was closed in 2 parts (-151.25 + 148.75 = -2.50 total)
Note: 0x789xyz has avg holding period of 0.04 hours (2.4 minutes) → HFT signal
```

---

## 3. Trader Daily Metrics (Aggregated Per Day)

Roll up fills into daily summaries per trader:

```
┌──────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                            trader_daily_metrics                                                                   │
├──────────────────────────┬────────────┬─────────────┬─────────────┬──────────────┬──────────┬──────────┬──────────┬──────────┬─────────┬─────────┤
│ user_address             │ date       │ volume      │ trade_count │ realized_pnl │ fees     │ net_pnl  │ maker_ct │ taker_ct │ wins    │ losses  │
├──────────────────────────┼────────────┼─────────────┼─────────────┼──────────────┼──────────┼──────────┼──────────┼──────────┼─────────┼─────────┤
│ 0xabc123...def           │ 2025-07-28 │ 164,962.50  │ 5           │ 337.25       │ -164.76  │ 172.49   │ 1        │ 4        │ 2       │ 1       │
│ 0xabc123...def           │ 2025-07-29 │ 89,450.00   │ 3           │ -523.10      │ -89.45   │ -612.55  │ 0        │ 3        │ 0       │ 2       │
│ 0xabc123...def           │ 2025-07-30 │ 212,100.00  │ 8           │ 1,245.80     │ -212.10  │ 1,033.70 │ 2        │ 6        │ 5       │ 1       │
│ 0x789xyz...456           │ 2025-07-28 │ 91,390.00   │ 47          │ 892.50       │ -91.39   │ 801.11   │ 45       │ 2        │ 38      │ 9       │
│ 0x789xyz...456           │ 2025-07-29 │ 156,200.00  │ 82          │ 1,105.30     │ -156.20  │ 949.10   │ 78       │ 4        │ 61      │ 21      │
│ 0x789xyz...456           │ 2025-07-30 │ 203,500.00  │ 103         │ 1,450.20     │ -203.50  │ 1,246.70 │ 99       │ 4        │ 79      │ 24      │
└──────────────────────────┴────────────┴─────────────┴─────────────┴──────────────┴──────────┴──────────┴──────────┴──────────┴─────────┴─────────┘

Observations:
- 0xabc123: Lower volume, fewer trades, mixed results, mostly taker
- 0x789xyz: High volume, many trades, consistent profits, 95%+ maker → HFT pattern
```

---

## 4. Trader Profiles (Lifetime Aggregates)

The main output table - one row per trader with all computed metrics:

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                          trader_profiles                                                                                 │
├──────────────────────────┬────────────┬─────────────┬─────────────┬───────────┬───────────┬──────────┬──────────┬────────────┬──────────┬──────────┬──────────┬─────────┤
│ user_address             │ wallet_age │ total_vol   │ total_trades│ all_pnl   │ pnl_30d   │ roi      │ sharpe   │ win_rate   │ maker_pct│ avg_hold │ mtm_tv   │ turnover│
├──────────────────────────┼────────────┼─────────────┼─────────────┼───────────┼───────────┼──────────┼──────────┼────────────┼──────────┼──────────┼──────────┼─────────┤
│ 0xabc123...def           │ 45 days    │ $2.4M       │ 312         │ +$52,340  │ +$8,450   │ 18.2%    │ 1.45     │ 58%        │ 22%      │ 4.2 hrs  │ 21.8 bps │ 2.1x    │
│ 0x789xyz...456           │ 180 days   │ $89.2M      │ 45,230      │ +$245,100 │ +$42,100  │ 8.5%     │ 2.10     │ 72%        │ 96%      │ 0.08 hrs │ 2.7 bps  │ 12.4x   │
│ 0xdef456...789           │ 220 days   │ $156.8M     │ 892         │ +$1.2M    │ +$180,200 │ 42.5%    │ 2.85     │ 64%        │ 35%      │ 18.5 hrs │ 76.5 bps │ 0.8x    │
│ 0x111aaa...bbb           │ 30 days    │ $450K       │ 45          │ -$23,400  │ -$23,400  │ -28.5%   │ -0.82    │ 31%        │ 12%      │ 2.1 hrs  │ -52.0 bps│ 1.5x    │
│ 0x222ccc...ddd           │ 365 days   │ $12.5M      │ 156         │ +$89,200  │ +$5,100   │ 12.8%    │ 0.95     │ 52%        │ 8%       │ 72.0 hrs │ 71.4 bps │ 0.2x    │
└──────────────────────────┴────────────┴─────────────┴─────────────┴───────────┴───────────┴──────────┴──────────┴────────────┴──────────┴──────────┴──────────┴─────────┘

                                                            ↓ CLASSIFICATION ↓

┌──────────────────────────┬───────────────────────┬────────────────────────────────────────────────────────────────────────┐
│ user_address             │ trader_type           │ classification_reason                                                  │
├──────────────────────────┼───────────────────────┼────────────────────────────────────────────────────────────────────────┤
│ 0xabc123...def           │ RETAIL                │ Low volume, mixed maker/taker, moderate holding period                 │
│ 0x789xyz...456           │ HFT                   │ maker%=96%, turnover=12.4x, mtm_tv=2.7bps, avg_hold=0.08hrs           │
│ 0xdef456...789           │ SMART_DIRECTIONAL     │ PnL=$1.2M, ROI=42.5%, Sharpe=2.85, mtm_tv=76.5bps, avg_hold=18.5hrs   │
│ 0x111aaa...bbb           │ RETAIL                │ Negative PnL, low win rate, no distinguishing features                 │
│ 0x222ccc...ddd           │ LIKELY_BASIS          │ Very long avg_hold=72hrs, low turnover=0.2x, consistent small profits  │
└──────────────────────────┴───────────────────────┴────────────────────────────────────────────────────────────────────────┘
```

### Metric Interpretations:

| Metric | 0xabc (Retail) | 0x789 (HFT) | 0xdef (Smart) | Threshold |
|--------|----------------|-------------|---------------|-----------|
| **maker_pct** | 22% | **96%** | 35% | ≥70% = HFT |
| **mtm_tv** | 21.8 bps | **2.7 bps** | **76.5 bps** | ≤10bps = HFT, ≥10bps = Directional |
| **avg_hold** | 4.2 hrs | **0.08 hrs** | 18.5 hrs | ≤1hr = HFT |
| **turnover** | 2.1x | **12.4x** | 0.8x | ≥5x = HFT |
| **sharpe** | 1.45 | 2.10 | **2.85** | ≥2.0 = Strong |
| **all_pnl** | $52K | $245K | **$1.2M** | ≥$500K for Smart |

---

## 5. Asset Signals (Aggregated Across Traders)

Roll up trader activity into per-asset signals:

```
┌────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                               asset_signals                                                                             │
├───────┬─────────────────────┬──────────────┬───────────────┬──────────────┬────────────────┬──────────────────┬──────────────────┬───────────────────────┤
│ coin  │ timestamp           │ smart_long $ │ smart_short $ │ smart_ls_rat │ smart_traders  │ fresh_wallet_vol │ confluence_z     │ signal                │
├───────┼─────────────────────┼──────────────┼───────────────┼──────────────┼────────────────┼──────────────────┼──────────────────┼───────────────────────┤
│ BTC   │ 2025-07-30 12:00    │ $12.5M       │ $3.2M         │ 3.91         │ 18 L / 5 S     │ $450K            │ 1.82             │ ⚠️ SMART MONEY LONG   │
│ ETH   │ 2025-07-30 12:00    │ $4.1M        │ $4.8M         │ 0.85         │ 8 L / 11 S     │ $120K            │ 0.45             │ NEUTRAL               │
│ SOL   │ 2025-07-30 12:00    │ $2.8M        │ $8.9M         │ 0.31         │ 4 L / 22 S     │ $890K            │ 2.15             │ 🔴 SMART MONEY SHORT  │
│ DOGE  │ 2025-07-30 12:00    │ $950K        │ $200K         │ 4.75         │ 12 L / 2 S     │ $1.2M            │ 1.95             │ ⚠️ FRESH WALLET ALERT │
│ ARB   │ 2025-07-30 12:00    │ $1.1M        │ $1.0M         │ 1.10         │ 6 L / 5 S      │ $50K             │ 0.12             │ NEUTRAL               │
└───────┴─────────────────────┴──────────────┴───────────────┴──────────────┴────────────────┴──────────────────┴──────────────────┴───────────────────────┘

Signal Logic:
- confluence_z > 1.5 + smart_ls_ratio > 2.0 → "SMART MONEY LONG"
- confluence_z > 1.5 + smart_ls_ratio < 0.5 → "SMART MONEY SHORT"
- fresh_wallet_vol > 2x avg → "FRESH WALLET ALERT"
```

---

## 6. Alerts Table

Generated alerts from signal processing:

```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│                                                                         alerts                                                                                   │
├────┬─────────────────────┬──────────────────────────┬───────┬──────────┬───────────────────────────────────────────────────────────────────────────────────────────┤
│ id │ timestamp           │ alert_type               │ coin  │ severity │ message                                                                                   │
├────┼─────────────────────┼──────────────────────────┼───────┼──────────┼───────────────────────────────────────────────────────────────────────────────────────────┤
│ 1  │ 2025-07-30 12:00    │ SMART_MONEY_CONFLUENCE   │ BTC   │ HIGH     │ 18 smart traders long BTC ($12.5M), L/S ratio 3.91, z-score 1.82                         │
│ 2  │ 2025-07-30 12:00    │ SMART_MONEY_CONFLUENCE   │ SOL   │ HIGH     │ 22 smart traders short SOL ($8.9M), L/S ratio 0.31, z-score 2.15                         │
│ 3  │ 2025-07-30 12:00    │ FRESH_WALLET_ACCUMULATION│ DOGE  │ MEDIUM   │ $1.2M volume from wallets < 7 days old (4.2x normal)                                     │
│ 4  │ 2025-07-30 11:45    │ LARGE_POSITION_OPEN      │ BTC   │ MEDIUM   │ 0xdef456...789 (Smart Directional) opened $2.1M long BTC                                 │
│ 5  │ 2025-07-30 10:30    │ WHALE_ACTIVITY           │ ETH   │ LOW      │ 0x789xyz...456 traded $5.2M ETH volume in last hour                                      │
└────┴─────────────────────┴──────────────────────────┴───────┴──────────┴───────────────────────────────────────────────────────────────────────────────────────────┘
```

---

## 7. Example: Single Trader Deep Dive

For a trader like `0xdef456...789` (Smart Directional), we can show:

### Performance Over Time
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 0xdef456...789 - Cumulative PnL                                                 │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                            $1.2M│
│                                                                      ___/       │
│                                                               __---/            │
│                                                        __---/                   │
│                                                  __--/                          │
│                                           ___.--                                │
│                                    __.---/                                      │
│                             __.---/                                             │
│                      __.---/                                                    │
│              __.----/                                                           │
│       __.---/                                                                   │
│ $0 --/                                                                          │
├─────────────────────────────────────────────────────────────────────────────────┤
│ May         Jun         Jul         Aug         Sep         Oct         Nov     │
└─────────────────────────────────────────────────────────────────────────────────┘
```

### Coin Breakdown (Winner Breakdown)
```
┌───────────────────────────────────────────────────┐
│ PnL Attribution by Coin (Winners Only)            │
├───────────────────────────────────────────────────┤
│ BTC   ████████████████████████████████████  42%   │
│ ETH   ██████████████████████████            31%   │
│ SOL   ████████████████                      18%   │
│ ARB   ██████                                 6%   │
│ Other ███                                    3%   │
└───────────────────────────────────────────────────┘

Total Winning PnL: $1.45M
Total Losing PnL:  -$250K
Net: $1.2M
```

### Recent Trades
```
┌─────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Recent Closed Positions                                                                                 │
├─────────────────────┬───────┬───────────┬────────────┬─────────────┬──────────┬─────────────────────────┤
│ Exit Time           │ Coin  │ Direction │ Entry      │ Exit        │ PnL      │ Holding                 │
├─────────────────────┼───────┼───────────┼────────────┼─────────────┼──────────┼─────────────────────────┤
│ 2025-07-30 14:22    │ BTC   │ LONG      │ $94,250    │ $96,100     │ +$18,500 │ 22.5 hrs                │
│ 2025-07-29 18:45    │ SOL   │ SHORT     │ $188.50    │ $182.20     │ +$6,300  │ 8.2 hrs                 │
│ 2025-07-29 09:10    │ ETH   │ LONG      │ $3,420     │ $3,380      │ -$4,000  │ 5.1 hrs                 │
│ 2025-07-28 22:00    │ BTC   │ LONG      │ $93,100    │ $94,800     │ +$8,500  │ 14.0 hrs                │
└─────────────────────┴───────┴───────────┴────────────┴─────────────┴──────────┴─────────────────────────┘
```

---

## Summary: Data Flow

```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│                 │     │                 │     │                 │     │                 │
│   S3 Fills      │────▶│  Position       │────▶│  Daily          │────▶│  Trader         │
│   (Raw)         │     │  Reconstruction │     │  Aggregates     │     │  Profiles       │
│                 │     │                 │     │                 │     │                 │
└─────────────────┘     └─────────────────┘     └─────────────────┘     └────────┬────────┘
                                                                                  │
                                                                                  ▼
                        ┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
                        │                 │     │                 │     │                 │
                        │   Alerts        │◀────│  Asset          │◀────│  Classification │
                        │                 │     │  Signals        │     │                 │
                        │                 │     │                 │     │                 │
                        └─────────────────┘     └─────────────────┘     └─────────────────┘
```

**Row counts (estimated for 6 months of data):**
- `fills`: ~500M-1B rows
- `position_history`: ~50M rows
- `trader_daily_metrics`: ~5M rows (100K traders × 180 days)
- `trader_profiles`: ~100K rows
- `asset_signals`: ~500K rows (180 days × 200 coins × hourly)
- `alerts`: ~10K rows
